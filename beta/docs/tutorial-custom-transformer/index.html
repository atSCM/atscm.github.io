<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-vK3UTo/8wHbaUn+dTQD0X6dzidqc5l7gczvH+Bnowwk="> <link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-light.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-VCcaD9+X/d4QGYRX7l5aMJ8BWgwfA8d3S7i/HC9rvvw="> <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.png rel=icon type=image/png> <link href=client/main.129837899.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Tutorial: Custom Transformer â€“ atscm</title><meta content="Tutorial: Custom Transformer in the atscm manual pages" name=description><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="fullscreen-content svelte-30lnsi"><nav class="is-spaced navbar"><div class=container><div class=navbar-brand> <a href=. class=navbar-item><strong>atscm</strong></a> <div class="burger navbar-burger" role=button><span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span></div></div> <div class=navbar-menu><div class=navbar-start><a href=beta class=navbar-item>Readme </a> <a href=beta/docs class="navbar-item is-active">Manual </a> <a href=beta/api class=navbar-item>Reference </a></div> <div class=navbar-end><div class="navbar-item has-dropdown is-hoverable"><p class=navbar-link><span>Version: <strong>beta</strong></span></p> <div class="is-right navbar-dropdown"><a href=latest class="navbar-item is-flex"><span>latest (1.0.1)</span> </a><a href=beta class="navbar-item is-active is-flex"><span>beta (1.0.0-beta.51)</span> </a></div></div> <div class="navbar-item search-item"> <div class=dropdown><div class=dropdown-trigger><div class=field><div class="control has-icons-left"><input class=input placeholder=Search... type=search> <span class="icon is-left is-small"><i class="fa-search fas"></i></span></div></div></div> </div></div> <div class=navbar-item><div class=buttons><a href=https://github.com/atscm class="button is-light"><span class=icon><i class="fa-github fab"></i></span></a></div></div></div></div></div></nav> <div class=message-section><div class=container><div class="is-warning message"><div class=message-body>Documentation for beta releases may be incomplete.</div></div></div></div> <section class=section><div class=container><div class=columns><div class=column> <div class=content><h1 id=tutorial-custom-transformer>Tutorial: Custom Transformer</h1><blockquote> <p>tl;dr: Jump to the <a href=https://github.com/atSCM/tutorial-custom-transformer>tutorial-custom-transformer repository</a> to see the results.</p> </blockquote> <p>In this document we'll guide you through the steps necessary to implement a custom Transformer. Our transformer will use <a href=http://babeljs.io>Babel</a> to transpile ES2015/ES6 JavaScript to plain ES5 JavaScript that works in all Browsers.</p> <h2 id=overview>Overview</h2><p>Custom transformers provide an easy way to extend the build functionality of <em>atscm</em>. Basically, a transformer implements two behaviours: How atvise server nodes are mapped to files (when running <code>atscm pull</code>) and vice versa (when running <code>atscm push</code>).</p> <p><strong>Where to store transformers</strong></p> <p>Basically, transformers can be stored anywhere inside your <em>atscm</em> project. When using a non-ES5 configuration language (such as ES2015 or TypeScript, chosen when running <code>atscm init</code>) transformers should also be written in this language. <em>atscm</em> will handle the transpilation of your transformer code automatically. If you plan to write multiple custom transformers for your project, it is recommended to create your transformers in an own directory, e.g <code>./atscm</code>.</p> <h2 id=step-0-project-setup>Step 0: Project setup</h2><p>In order to have the same starting point, create a new <em>atscm</em> project to follow this tutorial. Run <code>atscm init</code> and <strong>pick ES2015 as configuration language</strong>.</p> <p>As for now the atvise library is written in old ES5 JavaScript, we'll ignore it in our project. Adjust your project configuration accordingly:</p> <pre><code class=language-javascript><span class=hljs-comment>// Atviseproject.babel.js</span>

...

export <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>MyProject</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>Atviseproject</span> </span>{
  ...

  static <span class=hljs-keyword>get</span> ignoreNodes() {
    <span class=hljs-keyword>return</span> <span class=hljs-keyword>super</span>.ignoreNodes
      .concat([<span class=hljs-string>'ns=1;s=SYSTEM.LIBRARY.ATVISE'</span>]);
  }

}</code></pre> <p>Now we're ready to pull the project by running:</p> <pre><code>atscm pull</code></pre><p>We'll use the default project files for testing later.</p> <p>As suggested above, we'll store our custom transformer inside a new directory, <code>./atscm</code>. Create the directory and an empty file called <em>BabelTransformer.js</em>:</p> <pre><code class=language-bash>mkdir atscm
touch atscm/BabelTransformer.js</code></pre> <p>By now you should have a project containing an <code>./Atviseproject.babel.js</code> and an empty <code>./atscm/BabelTransformer.js</code> file. Make sure the <code>./src</code> directory contains at least the <em>default Main display</em> which should exist inside <code>./src/AGENT/DISPLAYS/Main.display</code>.</p> <h2 id=step-1-import-partialtransformer-class>Step 1: Import <em>PartialTransformer</em> class</h2><p>As we don't want to implement things twice we'll subclass <em>atscm</em>'s <a href=https://atscm.github.io/atscm/class/src/lib/transform/Transformer.js~Transformer.html>Transformer class</a>. As our transformer shall only be used for JavaScript source files we can even use the <a href=https://atscm.github.io/atscm/class/src/lib/transform/PartialTransformer.js~PartialTransformer.html>PartialTransformer class</a> which supports filtering source files out of the box. As both of these classes are exported from <em>atscm</em>'s main file, importing them is pretty straightforward. Inside the <em>BabelTransformer.js</em> file add:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer.js</span>

<span class=hljs-keyword>import</span> { PartialTransformer } <span class=hljs-keyword>from</span> <span class=hljs-string>'atscm'</span>;</code></pre> <h2 id=step-2-create-the-babeltransformer-class>Step 2: Create the <em>BabelTransformer</em> class</h2><p>The next step is to create and export our Transformer class:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer.js</span>

<span class=hljs-keyword>import</span> { PartialTransformer } <span class=hljs-keyword>from</span> <span class=hljs-string>'atscm'</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BabelTransformer</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>PartialTransformer</span> </span>{}</code></pre> <p>We just created a <em>PartialTransformer</em> subclass that is exported as the file's default export. For more detailed information on ES2015's module system <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export>take a look at the docs</a>.</p> <h2 id=step-3-use-babeltransformer>Step 3: Use <em>BabelTransformer</em></h2><p>By default, <em>atscm</em> uses just some standard transformers. Any additional transformers must be configured to use inside the project's <em>Atviseproject</em> file.</p> <p>First of all, we have to import our newly created <em>BabelTransformer</em> class:</p> <pre><code class=language-javascript><span class=hljs-comment>// Atviseproject.babel.js</span>

<span class=hljs-keyword>import</span> { Atviseproject } <span class=hljs-keyword>from</span> <span class=hljs-string>'atscm'</span>
<span class=hljs-keyword>import</span> BabelTransformer <span class=hljs-keyword>from</span> <span class=hljs-string>'./atscm/BabelTransformer'</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>MyProject</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>Atviseproject</span> </span>{ ... }</code></pre> <p>Now we override the <em>Atviseproject.useTransformers</em> <a href=https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Functions/get>getter</a> to use our transformer:</p> <pre><code class=language-javascript><span class=hljs-comment>// Atviseproject.babel.js</span>

...

export <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>MyProject</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>Atviseproject</span> </span>{
  ...

  static <span class=hljs-keyword>get</span> useTransformers() {
    <span class=hljs-keyword>return</span> <span class=hljs-keyword>super</span>.useTransformers
      .concat(<span class=hljs-keyword>new</span> BabelTransformer());
  }

}</code></pre> <p>This statement tells <em>atscm</em> to use a new <em>BabelTransformer</em> instance <strong>in addition to the default transformers</strong> (<code>super.useTransformers</code>).</p> <p>To verify everything worked so far run <code>atscm config</code>. Our new Transformer should show up in the <em>useTransformers</em> section:</p> <pre><code>$ atscm config
[08:38:16] Configuration at ~/custom-transformer/Atviseproject.babel.js
{ host: '10.211.55.4',
  port:
   { opc: 4840,
     http: 80 },
  useTransformers:
   [ DisplayTransformer&lt;>,
     ScriptTransformer&lt;>,
     BabelTransformer&lt;> ],
  ...</code></pre><h2 id=step-4-implement-partialtransformershouldbetransformed>Step 4: Implement <em>PartialTransformer#shouldBeTransformed</em></h2><p><a href=https://atscm.github.io/atscm/class/src/lib/transform/PartialTransformer.js~PartialTransformer.html#instance-method-shouldBeTransformed>PartialTransformer#shouldBeTransformed</a> is responsible for filtering the files we want to transform. Returning <code>true</code> means the piped file will be transformed, <code>false</code> bypasses the file.</p> <p>In out case we want to edit all JavaScript source files. Therefore we return true for all files with the extension <code>.js</code>. Edit <em>BabelTransformer.js</em> accordingly:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer</span>

...

export <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BabelTransformer</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>PartialTransformer</span> </span>{

  shouldBeTransformed(file) {
    <span class=hljs-keyword>return</span> file.extname === <span class=hljs-string>'.js'</span>;
  }

}</code></pre> <h2 id=step-5-implement-transformertransformfromfilesystem>Step 5: Implement <em>Transformer#transformFromFilesystem</em></h2><p>Implementing <a href=https://atscm.github.io/atscm/class/src/lib/transform/Transformer.js~Transformer.html#instance-method-transformFromFilesystem>Transformer#transformFromFilesystem</a> is probably the most important part of this tutorial. In here we define the logic that actually creates ES5 code from ES2015 sources.</p> <p>First of all, we need to <strong>install additional dependencies</strong> required. Running</p> <pre><code class=language-bash>npm install --save-dev babel-core babel-preset-2015</code></pre> <p>will install <a href=http://babeljs.io>Babel</a> and it's ES2015 preset. This preset ensures all ES5 compatible browsers will be able to run the resulting code.</p> <p>We will also need the <a href=https://nodejs.org/api/buffer.html>node.js buffer module</a>. We don't need to install it, as it comes with every node installation.</p> <p>Next, import these modules as usual:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer.js</span>

<span class=hljs-keyword>import</span> { Buffer } <span class=hljs-keyword>from</span> <span class=hljs-string>'buffer'</span>;
<span class=hljs-keyword>import</span> { PartialTransformer } <span class=hljs-keyword>from</span> <span class=hljs-string>'atscm'</span>;
<span class=hljs-keyword>import</span> { transform } <span class=hljs-keyword>from</span> <span class=hljs-string>'babel-core'</span>;

...</code></pre> <p>The import order follows a pretty usual convention:</p> <ol> <li>Core <strong>node.js modules</strong> (<em>buffer</em> in our case)</li> <li>Other <strong>external modules</strong> (<em>babel-core</em> and <em>atscm</em> in our case)</li> <li><strong>Relative modules</strong> (<em>./atscm/BabelTransformer.js</em> inside <em>Atviseproject.babel.js</em> in our case)</li> </ol> <p>Now we're ready to implement <em>Transformer#transformFromFilesystem</em>. What we're about to do is pretty simple:</p> <ul> <li>We'll transpile the contents of the passed file with babels <em>transform</em> method</li> <li>We clone the passed file and set it's contents to a Buffer containing the resulting code</li> <li>We pass the resulting file to other streams</li> </ul> <pre><code class=language-javascript><span class=hljs-keyword>import</span> ...

export <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BabelTransformer</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>PartialTransformer</span> </span>{

  <span class=hljs-keyword>static</span> shouldBeTransformed(file) { ... }

  transformFromFilesystem(file, enc, callback) {
    <span class=hljs-comment>// Create ES5 code</span>
    <span class=hljs-keyword>const</span> { code } = transform(file.contents, {
      <span class=hljs-attr>presets</span>: [<span class=hljs-string>'es2015'</span>]
    });

    <span class=hljs-comment>// Create new file with ES5 content</span>
    <span class=hljs-keyword>const</span> result = file.clone();
    result.contents = Buffer.from(code);

    <span class=hljs-comment>// We're done, pass the new file to other streams</span>
    callback(<span class=hljs-literal>null</span>, result);
  }

}</code></pre> <p><strong>Wow!</strong> You just implemented your first custom transformer! Now we can write any scripts using the new ES2015 syntax.</p> <h2 id=step-6-test-babeltransformer>Step 6: Test <em>BabelTransformer</em></h2><p>It's time to check if everything works as expected. Create a script file for the Main display containing ES2015 JavaScript:</p> <pre><code class=language-javascript><span class=hljs-comment>// src/AGENT/DISPLAYS/Main.display/Main.js</span>

<span class=hljs-comment>// Class syntax</span>
<span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>Test</span> </span>{
  <span class=hljs-keyword>constructor</span>(options = {}, ...otherArgs) {
    <span class=hljs-comment>// Default values and rest params</span>
    <span class=hljs-keyword>this</span>.options = options;
    <span class=hljs-keyword>this</span>.args = otherArgs.map(<span class=hljs-function><span class=hljs-params>arg</span> =></span> <span class=hljs-built_in>parseInt</span>(arg, <span class=hljs-number>10</span>)); <span class=hljs-comment>// Arrows and Lexical This</span>
  }
}

<span class=hljs-keyword>const</span> a = <span class=hljs-number>13</span>; <span class=hljs-comment>// Constants</span>
<span class=hljs-keyword>const</span> { options, args } = <span class=hljs-keyword>new</span> Test({ a }, <span class=hljs-string>'23'</span>); <span class=hljs-comment>// Enhanced Object Literals</span>

alert(<span class=hljs-string>`Option a: <span class=hljs-subst>${options.a}</span>, args: <span class=hljs-subst>${args.join(<span class=hljs-string>', '</span>)}</span>`</span>); <span class=hljs-comment>// Template Strings</span></code></pre> <p>Run <code>atscm push</code> to upload the new display script to atvise server. Open your atvise project in your favorite browser (you may have to delete the browser cache) and if everything worked you should see an alert box containing the text "Option a: 13, args: 23". When you inspect the page's source you'll see the display script code was transpiled to ES5.</p> <h2 id=step-7-implement-transformertransformfromdb>Step 7: Implement <em>Transformer#transformFromDB</em></h2><p>As said at the beginning, atscm transformers allow transformation from and to the filesystem. A babel transpilation is a one-way process, meaning you cannot create ES2015 source code from the resulting ES5 code. Therefore the only thing we can do when transforming from atvise server to the filesystem is to prevent an override.</p> <p>We do so by implementing <a href=https://atscm.github.io/atscm/class/src/lib/transform/Transformer.js~Transformer.html#instance-method-transformFromDB>Transformer#transformFromDB</a>:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer.js</span>
...

export <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BabelTransformer</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>PartialTransfromer</span> </span>{
  ...

  transformFromDB(file, enc, callback) {
    <span class=hljs-comment>// Optionally, we could print a warning here</span>
    callback(<span class=hljs-literal>null</span>); <span class=hljs-comment>// Ignore file, remove it from the stream</span>
  }
}</code></pre> <p>Now we can run <code>atscm push</code> without overriding our ES2015 source code.</p> <h2 id=result>Result</h2><p>This is how your custom transformer should look now:</p> <pre><code class=language-javascript><span class=hljs-comment>// atscm/BabelTransformer.js</span>

<span class=hljs-keyword>import</span> { Buffer } <span class=hljs-keyword>from</span> <span class=hljs-string>'buffer'</span>;
<span class=hljs-keyword>import</span> { PartialTransformer } <span class=hljs-keyword>from</span> <span class=hljs-string>'atscm'</span>;
<span class=hljs-keyword>import</span> { transform } <span class=hljs-keyword>from</span> <span class=hljs-string>'babel-core'</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BabelTransformer</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>PartialTransformer</span> </span>{
  shouldBeTransformed(file) {
    <span class=hljs-keyword>return</span> file.extname === <span class=hljs-string>'.js'</span>;
  }

  transformFromFilesystem(file, enc, callback) {
    <span class=hljs-comment>// Create ES5 code</span>
    <span class=hljs-keyword>const</span> { code } = transform(file.contents, {
      <span class=hljs-attr>presets</span>: [<span class=hljs-string>'es2015'</span>],
    });

    <span class=hljs-comment>// Create new file with ES5 content</span>
    <span class=hljs-keyword>const</span> result = file.clone();
    result.contents = Buffer.from(code);

    <span class=hljs-comment>// We're done, pass the new file to other streams</span>
    callback(<span class=hljs-literal>null</span>, result);
  }

  transformFromDB(file, enc, callback) {
    callback(<span class=hljs-literal>null</span>); <span class=hljs-comment>// Ignore file, remove it from the stream</span>
  }
}</code></pre> <h2 id=conclusion>Conclusion</h2><p>We just created a custom Transformer in no time. It transpiles ES2015 code on push and prevents overriding this code on pull.</p> <p>Of course there are many ways to improve the transformer, for example:</p> <ul> <li>Handle options to configure how babel transpiles the source code</li> </ul> <h2 id=further-reading>Further reading</h2><ul> <li><a href=http://babeljs.io/learn-es2015/ >babeljs.io</a> provides a nice overview of ES2015 features. You can also use the <a href=http://babeljs.io/repl/ >REPL</a> to try out these features.</li> </ul> </div></div> <div class="column is-3"><aside class=menu><ul class=menu-list><li><a href=beta/docs/node-id-conflicts>Node ID conflicts</a> <li><a href=beta/docs/guide-gulpjs-plugins>Guide: gulp.js plugins</a> <li><a href=beta/docs/guide-debugging-atscm>Guide: Debugging atscm</a> <li><a href=beta/docs/guide-error-handling>Guide: Error handling</a> <li><a href=beta/docs/tutorial-custom-transformer class=is-active>Tutorial: Custom Transformer</a> <ul class=menu-list><li><a href=beta/docs/tutorial-custom-transformer/#overview>Overview</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-0-project-setup>Step 0: Project setup</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-1-import-partialtransformer-class>Step 1: Import PartialTransformer class</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-2-create-the-babeltransformer-class>Step 2: Create the BabelTransformer class</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-3-use-babeltransformer>Step 3: Use BabelTransformer</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-4-implement-partialtransformershouldbetransformed>Step 4: Implement PartialTransformer#shouldBeTransformed</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-5-implement-transformertransformfromfilesystem>Step 5: Implement Transformer#transformFromFilesystem</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-6-test-babeltransformer>Step 6: Test BabelTransformer</a> <li><a href=beta/docs/tutorial-custom-transformer/#step-7-implement-transformertransformfromdb>Step 7: Implement Transformer#transformFromDB</a> <li><a href=beta/docs/tutorial-custom-transformer/#result>Result</a> <li><a href=beta/docs/tutorial-custom-transformer/#conclusion>Conclusion</a> <li><a href=beta/docs/tutorial-custom-transformer/#further-reading>Further reading</a> </li> </ul> <li><a href=beta/docs/contribute-testing-atscm>Contribute: Testing atscm</a> <li><a href=beta/docs/contributing>Contributing</a> <li><a href=beta/docs/changelog>Changelog</a> </ul></aside></div></div></div></section></div> <footer class=footer><div class="content has-text-centered"><p><strong>atscm</strong> is an open source project by <a href=https://bachmann.info>Bachmann electronics</a> Â· The source code is licensed <a href=http://opensource.org/licenses/mit-license.php>MIT</a></p> <p><a href=https://github.com/atSCM/atscm/blob/master/.github/CONTRIBUTING.md target=_blank>Get involved </a> Â· <a href=https://github.com/atSCM/docs target=_blank>Improve this page</a> Â· <a href=https://www.bachmann.info/en/info/imprint/ target=_blank>Imprint</a></div></footer> </div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},(function(a,b,c,d,e,f,g,h,i){return {topics:[{title:"Node ID conflicts",slug:"node-id-conflicts",sections:[{title:"How atscm handles id conflicts",slug:"how-atscm-handles-id-conflicts"},{title:"How to resolve id conflicts",slug:"how-to-resolve-id-conflicts"}]},{title:"Guide: gulp.js plugins",slug:"guide-gulpjs-plugins",sections:[{title:"Using Transformer class",slug:"using-transformer-class"},{title:"Using PartialTransformer class",slug:"using-partialtransformer-class"},{title:d,slug:e},{title:f,slug:g}]},{title:"Guide: Debugging atscm",slug:"guide-debugging-atscm",sections:[]},{title:"Guide: Error handling",slug:"guide-error-handling",sections:[{title:"Adding source locations",slug:"adding-source-locations"}]},{title:"Tutorial: Custom Transformer",slug:"tutorial-custom-transformer",sections:[{title:"Overview",slug:"overview"},{title:"Step 0: Project setup",slug:"step-0-project-setup"},{title:"Step 1: Import PartialTransformer class",slug:"step-1-import-partialtransformer-class"},{title:"Step 2: Create the BabelTransformer class",slug:"step-2-create-the-babeltransformer-class"},{title:"Step 3: Use BabelTransformer",slug:"step-3-use-babeltransformer"},{title:"Step 4: Implement PartialTransformer#shouldBeTransformed",slug:"step-4-implement-partialtransformershouldbetransformed"},{title:"Step 5: Implement Transformer#transformFromFilesystem",slug:"step-5-implement-transformertransformfromfilesystem"},{title:"Step 6: Test BabelTransformer",slug:"step-6-test-babeltransformer"},{title:"Step 7: Implement Transformer#transformFromDB",slug:"step-7-implement-transformertransformfromdb"},{title:"Result",slug:"result"},{title:d,slug:e},{title:f,slug:g}]},{title:"Contribute: Testing atscm",slug:"contribute-testing-atscm",sections:[{title:"Unit tests",slug:"unit-tests"},{title:"Integration tests",slug:"integration-tests",children:[{title:"Test setups",slug:"test-setups"}]}]},{title:"Contributing",slug:"contributing",sections:[{title:"Found a bug?",slug:"found-a-bug"},{title:"Missing a feature?",slug:"missing-a-feature"},{title:"Submission Guidelines",slug:"submission-guidelines",children:[{title:"Submitting an issue",slug:"submitting-an-issue"},{title:"Submitting a Pull Request (PR)",slug:"submitting-a-pull-request-pr"}]},{title:"Code quality control",slug:"code-quality-control"},{title:"Setting up the development environment",slug:"setting-up-the-development-environment",children:[{title:"Linting files",slug:"linting-files"},{title:"Running tests",slug:"running-tests"},{title:"Creating API documentation",slug:"creating-api-documentation"}]},{title:"Commit Message Guideline",slug:"commit-message-guideline",children:[{title:"Commit message format",slug:"commit-message-format",children:[{title:"Type",slug:"type"},{title:"Scope",slug:"scope"},{title:"Subject",slug:"subject"},{title:"Body",slug:"body"},{title:"Footer",slug:"footer"}]},{title:"Commit message linting",slug:"commit-message-linting"}]}]},{title:"Changelog",slug:"changelog",sections:[{title:"1.0.0-beta.51 (2020-04-21)",slug:"100-beta51-2020-04-21",children:[{title:a,slug:"bug-fixes",children:[{title:b,slug:"features"},{title:c,slug:"performance-improvements"},{title:h,slug:"breaking-changes"}]}]},{title:"0.6.0 (2018-06-17)",slug:"060-2018-06-17",children:[{title:a,slug:"bug-fixes-1",children:[{title:b,slug:"features-1"}]},{title:"0.5.1 (2018-02-16)",slug:"051-2018-02-16",children:[{title:a,slug:"bug-fixes-2"}]}]},{title:"0.5.0 (2018-02-09)",slug:"050-2018-02-09",children:[{title:b,slug:"features-2"},{title:"0.4.3 (2018-02-08)",slug:"043-2018-02-08",children:[{title:a,slug:"bug-fixes-3"}]},{title:"0.4.2 (2017-12-19)",slug:"042-2017-12-19",children:[{title:a,slug:"bug-fixes-4"}]},{title:"0.4.1 (2017-12-18)",slug:"041-2017-12-18",children:[{title:a,slug:"bug-fixes-5"},{title:i,slug:"reverts"}]}]},{title:"0.4.0 (2017-11-21)",slug:"040-2017-11-21",children:[{title:a,slug:"bug-fixes-6",children:[{title:b,slug:"features-3"}]}]},{title:"0.3.0 (2017-05-08)",slug:"030-2017-05-08",children:[{title:a,slug:"bug-fixes-7",children:[{title:b,slug:"features-4"},{title:i,slug:"reverts-1"}]},{title:"0.2.4 (2017-04-05)",slug:"024-2017-04-05",children:[{title:a,slug:"bug-fixes-8"}]},{title:"0.2.3 (2017-04-05)",slug:"023-2017-04-05",children:[{title:a,slug:"bug-fixes-9"}]},{title:"0.2.2 (2017-03-20)",slug:"022-2017-03-20",children:[{title:a,slug:"bug-fixes-10"},{title:b,slug:"features-5"},{title:c,slug:"performance-improvements-1"}]},{title:"0.2.1 (2017-03-13)",slug:"021-2017-03-13",children:[{title:a,slug:"bug-fixes-11"},{title:"Chores",slug:"chores"},{title:b,slug:"features-6"},{title:c,slug:"performance-improvements-2"},{title:h,slug:"breaking-changes-1"}]}]},{title:"0.2.0 (2017-03-08)",slug:"020-2017-03-08",children:[{title:a,slug:"bug-fixes-12",children:[{title:b,slug:"features-7"}]},{title:"0.1.2 (2017-02-23)",slug:"012-2017-02-23"},{title:"0.1.1 (2017-02-22)",slug:"011-2017-02-22",children:[{title:a,slug:"bug-fixes-13"},{title:b,slug:"features-8"},{title:c,slug:"performance-improvements-3"}]}]},{title:"0.1.0 (2017-02-21)",slug:"010-2017-02-21"}]}]}}("Bug Fixes","Features","Performance Improvements","Conclusion","conclusion","Further reading","further-reading","BREAKING CHANGES","Reverts")),{manual:{content:"\u003Ch1 id=\"tutorial-custom-transformer\"\u003ETutorial: Custom Transformer\u003C\u002Fh1\u003E\u003Cblockquote\u003E\n\u003Cp\u003Etl;dr: Jump to the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FatSCM\u002Ftutorial-custom-transformer\"\u003Etutorial-custom-transformer repository\u003C\u002Fa\u003E to see the results.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003EIn this document we&#39;ll guide you through the steps necessary to implement a custom Transformer.\nOur transformer will use \u003Ca href=\"http:\u002F\u002Fbabeljs.io\"\u003EBabel\u003C\u002Fa\u003E to transpile ES2015\u002FES6 JavaScript to plain ES5 JavaScript that works in all Browsers.\u003C\u002Fp\u003E\n\u003Ch2 id=\"overview\"\u003EOverview\u003C\u002Fh2\u003E\u003Cp\u003ECustom transformers provide an easy way to extend the build functionality of \u003Cem\u003Eatscm\u003C\u002Fem\u003E. Basically, a transformer implements two behaviours: How atvise server nodes are mapped to files (when running \u003Ccode\u003Eatscm pull\u003C\u002Fcode\u003E) and vice versa (when running \u003Ccode\u003Eatscm push\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EWhere to store transformers\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EBasically, transformers can be stored anywhere inside your \u003Cem\u003Eatscm\u003C\u002Fem\u003E project. When using a non-ES5 configuration language (such as ES2015 or TypeScript, chosen when running \u003Ccode\u003Eatscm init\u003C\u002Fcode\u003E) transformers should also be written in this language. \u003Cem\u003Eatscm\u003C\u002Fem\u003E will handle the transpilation of your transformer code automatically. If you plan to write multiple custom transformers for your project, it is recommended to create your transformers in an own directory, e.g \u003Ccode\u003E.\u002Fatscm\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Ch2 id=\"step-0-project-setup\"\u003EStep 0: Project setup\u003C\u002Fh2\u003E\u003Cp\u003EIn order to have the same starting point, create a new \u003Cem\u003Eatscm\u003C\u002Fem\u003E project to follow this tutorial. Run \u003Ccode\u003Eatscm init\u003C\u002Fcode\u003E and \u003Cstrong\u003Epick ES2015 as configuration language\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EAs for now the atvise library is written in old ES5 JavaScript, we&#39;ll ignore it in our project. Adjust your project configuration accordingly:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Atviseproject.babel.js\u003C\u002Fspan\u003E\n\n...\n\nexport \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EMyProject\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EAtviseproject\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  ...\n\n  static \u003Cspan class=\"hljs-keyword\"\u003Eget\u003C\u002Fspan\u003E ignoreNodes() {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Esuper\u003C\u002Fspan\u003E.ignoreNodes\n      .concat([\u003Cspan class=\"hljs-string\"\u003E'ns=1;s=SYSTEM.LIBRARY.ATVISE'\u003C\u002Fspan\u003E]);\n  }\n\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ENow we&#39;re ready to pull the project by running:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Eatscm pull\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EWe&#39;ll use the default project files for testing later.\u003C\u002Fp\u003E\n\u003Cp\u003EAs suggested above, we&#39;ll store our custom transformer inside a new directory, \u003Ccode\u003E.\u002Fatscm\u003C\u002Fcode\u003E. Create the directory and an empty file called \u003Cem\u003EBabelTransformer.js\u003C\u002Fem\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Emkdir atscm\ntouch atscm\u002FBabelTransformer.js\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EBy now you should have a project containing an \u003Ccode\u003E.\u002FAtviseproject.babel.js\u003C\u002Fcode\u003E and an empty \u003Ccode\u003E.\u002Fatscm\u002FBabelTransformer.js\u003C\u002Fcode\u003E file.\nMake sure the \u003Ccode\u003E.\u002Fsrc\u003C\u002Fcode\u003E directory contains at least the \u003Cem\u003Edefault Main display\u003C\u002Fem\u003E which should exist inside \u003Ccode\u003E.\u002Fsrc\u002FAGENT\u002FDISPLAYS\u002FMain.display\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Ch2 id=\"step-1-import-partialtransformer-class\"\u003EStep 1: Import \u003Cem\u003EPartialTransformer\u003C\u002Fem\u003E class\u003C\u002Fh2\u003E\u003Cp\u003EAs we don&#39;t want to implement things twice we&#39;ll subclass \u003Cem\u003Eatscm\u003C\u002Fem\u003E&#39;s \u003Ca href=\"https:\u002F\u002Fatscm.github.io\u002Fatscm\u002Fclass\u002Fsrc\u002Flib\u002Ftransform\u002FTransformer.js~Transformer.html\"\u003ETransformer class\u003C\u002Fa\u003E. As our transformer shall only be used for JavaScript source files we can even use the \u003Ca href=\"https:\u002F\u002Fatscm.github.io\u002Fatscm\u002Fclass\u002Fsrc\u002Flib\u002Ftransform\u002FPartialTransformer.js~PartialTransformer.html\"\u003EPartialTransformer class\u003C\u002Fa\u003E which supports filtering source files out of the box. As both of these classes are exported from \u003Cem\u003Eatscm\u003C\u002Fem\u003E&#39;s main file, importing them is pretty straightforward. Inside the \u003Cem\u003EBabelTransformer.js\u003C\u002Fem\u003E file add:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { PartialTransformer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"step-2-create-the-babeltransformer-class\"\u003EStep 2: Create the \u003Cem\u003EBabelTransformer\u003C\u002Fem\u003E class\u003C\u002Fh2\u003E\u003Cp\u003EThe next step is to create and export our Transformer class:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { PartialTransformer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EBabelTransformer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EPartialTransformer\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EWe just created a \u003Cem\u003EPartialTransformer\u003C\u002Fem\u003E subclass that is exported as the file&#39;s default export. For more detailed information on ES2015&#39;s module system \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FStatements\u002Fexport\"\u003Etake a look at the docs\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Ch2 id=\"step-3-use-babeltransformer\"\u003EStep 3: Use \u003Cem\u003EBabelTransformer\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\u003Cp\u003EBy default, \u003Cem\u003Eatscm\u003C\u002Fem\u003E uses just some standard transformers. Any additional transformers must be configured to use inside the project&#39;s \u003Cem\u003EAtviseproject\u003C\u002Fem\u003E file.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst of all, we have to import our newly created \u003Cem\u003EBabelTransformer\u003C\u002Fem\u003E class:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Atviseproject.babel.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { Atviseproject } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E BabelTransformer \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'.\u002Fatscm\u002FBabelTransformer'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EMyProject\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EAtviseproject\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{ ... }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ENow we override the \u003Cem\u003EAtviseproject.useTransformers\u003C\u002Fem\u003E \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fde\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FFunctions\u002Fget\"\u003Egetter\u003C\u002Fa\u003E to use our transformer:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Atviseproject.babel.js\u003C\u002Fspan\u003E\n\n...\n\nexport \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EMyProject\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EAtviseproject\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  ...\n\n  static \u003Cspan class=\"hljs-keyword\"\u003Eget\u003C\u002Fspan\u003E useTransformers() {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Esuper\u003C\u002Fspan\u003E.useTransformers\n      .concat(\u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E BabelTransformer());\n  }\n\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThis statement tells \u003Cem\u003Eatscm\u003C\u002Fem\u003E to use a new \u003Cem\u003EBabelTransformer\u003C\u002Fem\u003E instance \u003Cstrong\u003Ein addition to the default transformers\u003C\u002Fstrong\u003E (\u003Ccode\u003Esuper.useTransformers\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003ETo verify everything worked so far run \u003Ccode\u003Eatscm config\u003C\u002Fcode\u003E. Our new Transformer should show up in the \u003Cem\u003EuseTransformers\u003C\u002Fem\u003E section:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E$ atscm config\n[08:38:16] Configuration at ~\u002Fcustom-transformer\u002FAtviseproject.babel.js\n{ host: &#39;10.211.55.4&#39;,\n  port:\n   { opc: 4840,\n     http: 80 },\n  useTransformers:\n   [ DisplayTransformer&lt;&gt;,\n     ScriptTransformer&lt;&gt;,\n     BabelTransformer&lt;&gt; ],\n  ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"step-4-implement-partialtransformershouldbetransformed\"\u003EStep 4: Implement \u003Cem\u003EPartialTransformer#shouldBeTransformed\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fatscm.github.io\u002Fatscm\u002Fclass\u002Fsrc\u002Flib\u002Ftransform\u002FPartialTransformer.js~PartialTransformer.html#instance-method-shouldBeTransformed\"\u003EPartialTransformer#shouldBeTransformed\u003C\u002Fa\u003E is responsible for filtering the files we want to transform. Returning \u003Ccode\u003Etrue\u003C\u002Fcode\u003E means the piped file will be transformed, \u003Ccode\u003Efalse\u003C\u002Fcode\u003E bypasses the file.\u003C\u002Fp\u003E\n\u003Cp\u003EIn out case we want to edit all JavaScript source files. Therefore we return true for all files with the extension \u003Ccode\u003E.js\u003C\u002Fcode\u003E. Edit \u003Cem\u003EBabelTransformer.js\u003C\u002Fem\u003E accordingly:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer\u003C\u002Fspan\u003E\n\n...\n\nexport \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EBabelTransformer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EPartialTransformer\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n\n  shouldBeTransformed(file) {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E file.extname === \u003Cspan class=\"hljs-string\"\u003E'.js'\u003C\u002Fspan\u003E;\n  }\n\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"step-5-implement-transformertransformfromfilesystem\"\u003EStep 5: Implement \u003Cem\u003ETransformer#transformFromFilesystem\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\u003Cp\u003EImplementing \u003Ca href=\"https:\u002F\u002Fatscm.github.io\u002Fatscm\u002Fclass\u002Fsrc\u002Flib\u002Ftransform\u002FTransformer.js~Transformer.html#instance-method-transformFromFilesystem\"\u003ETransformer#transformFromFilesystem\u003C\u002Fa\u003E is probably the most important part of this tutorial. In here we define the logic that actually creates ES5 code from ES2015 sources.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst of all, we need to \u003Cstrong\u003Einstall additional dependencies\u003C\u002Fstrong\u003E required. Running\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Enpm install --save-dev babel-core babel-preset-2015\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Ewill install \u003Ca href=\"http:\u002F\u002Fbabeljs.io\"\u003EBabel\u003C\u002Fa\u003E and it&#39;s ES2015 preset. This preset ensures all ES5 compatible browsers will be able to run the resulting code.\u003C\u002Fp\u003E\n\u003Cp\u003EWe will also need the \u003Ca href=\"https:\u002F\u002Fnodejs.org\u002Fapi\u002Fbuffer.html\"\u003Enode.js buffer module\u003C\u002Fa\u003E. We don&#39;t need to install it, as it comes with every node installation.\u003C\u002Fp\u003E\n\u003Cp\u003ENext, import these modules as usual:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { Buffer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'buffer'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { PartialTransformer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { transform } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'babel-core'\u003C\u002Fspan\u003E;\n\n...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe import order follows a pretty usual convention:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003ECore \u003Cstrong\u003Enode.js modules\u003C\u002Fstrong\u003E (\u003Cem\u003Ebuffer\u003C\u002Fem\u003E in our case)\u003C\u002Fli\u003E\n\u003Cli\u003EOther \u003Cstrong\u003Eexternal modules\u003C\u002Fstrong\u003E (\u003Cem\u003Ebabel-core\u003C\u002Fem\u003E and \u003Cem\u003Eatscm\u003C\u002Fem\u003E in our case)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003ERelative modules\u003C\u002Fstrong\u003E (\u003Cem\u003E.\u002Fatscm\u002FBabelTransformer.js\u003C\u002Fem\u003E inside \u003Cem\u003EAtviseproject.babel.js\u003C\u002Fem\u003E in our case)\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003ENow we&#39;re ready to implement \u003Cem\u003ETransformer#transformFromFilesystem\u003C\u002Fem\u003E. What we&#39;re about to do is pretty simple:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EWe&#39;ll transpile the contents of the passed file with babels \u003Cem\u003Etransform\u003C\u002Fem\u003E method\u003C\u002Fli\u003E\n\u003Cli\u003EWe clone the passed file and set it&#39;s contents to a Buffer containing the resulting code\u003C\u002Fli\u003E\n\u003Cli\u003EWe pass the resulting file to other streams\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E ...\n\nexport \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EBabelTransformer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EPartialTransformer\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n\n  \u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E shouldBeTransformed(file) { ... }\n\n  transformFromFilesystem(file, enc, callback) {\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create ES5 code\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { code } = transform(file.contents, {\n      \u003Cspan class=\"hljs-attr\"\u003Epresets\u003C\u002Fspan\u003E: [\u003Cspan class=\"hljs-string\"\u003E'es2015'\u003C\u002Fspan\u003E]\n    });\n\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create new file with ES5 content\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E result = file.clone();\n    result.contents = Buffer.from(code);\n\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F We're done, pass the new file to other streams\u003C\u002Fspan\u003E\n    callback(\u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E, result);\n  }\n\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003EWow!\u003C\u002Fstrong\u003E You just implemented your first custom transformer! Now we can write any scripts using the new ES2015 syntax.\u003C\u002Fp\u003E\n\u003Ch2 id=\"step-6-test-babeltransformer\"\u003EStep 6: Test \u003Cem\u003EBabelTransformer\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\u003Cp\u003EIt&#39;s time to check if everything works as expected. Create a script file for the Main display containing ES2015 JavaScript:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F src\u002FAGENT\u002FDISPLAYS\u002FMain.display\u002FMain.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Class syntax\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ETest\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Econstructor\u003C\u002Fspan\u003E(options = {}, ...otherArgs) {\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Default values and rest params\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.options = options;\n    \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.args = otherArgs.map(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Earg\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(arg, \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E)); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Arrows and Lexical This\u003C\u002Fspan\u003E\n  }\n}\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E a = \u003Cspan class=\"hljs-number\"\u003E13\u003C\u002Fspan\u003E; \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Constants\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { options, args } = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E Test({ a }, \u003Cspan class=\"hljs-string\"\u003E'23'\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Enhanced Object Literals\u003C\u002Fspan\u003E\n\nalert(\u003Cspan class=\"hljs-string\"\u003E`Option a: \u003Cspan class=\"hljs-subst\"\u003E${options.a}\u003C\u002Fspan\u003E, args: \u003Cspan class=\"hljs-subst\"\u003E${args.join(\u003Cspan class=\"hljs-string\"\u003E', '\u003C\u002Fspan\u003E)}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Template Strings\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ERun \u003Ccode\u003Eatscm push\u003C\u002Fcode\u003E to upload the new display script to atvise server. Open your atvise project in your favorite browser (you may have to delete the browser cache) and if everything worked you should see an alert box containing the text &quot;Option a: 13, args: 23&quot;. When you inspect the page&#39;s source you&#39;ll see the display script code was transpiled to ES5.\u003C\u002Fp\u003E\n\u003Ch2 id=\"step-7-implement-transformertransformfromdb\"\u003EStep 7: Implement \u003Cem\u003ETransformer#transformFromDB\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\u003Cp\u003EAs said at the beginning, atscm transformers allow transformation from and to the filesystem. A babel transpilation is a one-way process, meaning you cannot create ES2015 source code from the resulting ES5 code. Therefore the only thing we can do when transforming from atvise server to the filesystem is to prevent an override.\u003C\u002Fp\u003E\n\u003Cp\u003EWe do so by implementing \u003Ca href=\"https:\u002F\u002Fatscm.github.io\u002Fatscm\u002Fclass\u002Fsrc\u002Flib\u002Ftransform\u002FTransformer.js~Transformer.html#instance-method-transformFromDB\"\u003ETransformer#transformFromDB\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer.js\u003C\u002Fspan\u003E\n...\n\nexport \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EBabelTransformer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EPartialTransfromer\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  ...\n\n  transformFromDB(file, enc, callback) {\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Optionally, we could print a warning here\u003C\u002Fspan\u003E\n    callback(\u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Ignore file, remove it from the stream\u003C\u002Fspan\u003E\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ENow we can run \u003Ccode\u003Eatscm push\u003C\u002Fcode\u003E without overriding our ES2015 source code.\u003C\u002Fp\u003E\n\u003Ch2 id=\"result\"\u003EResult\u003C\u002Fh2\u003E\u003Cp\u003EThis is how your custom transformer should look now:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F atscm\u002FBabelTransformer.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { Buffer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'buffer'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { PartialTransformer } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { transform } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'babel-core'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EBabelTransformer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EPartialTransformer\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  shouldBeTransformed(file) {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E file.extname === \u003Cspan class=\"hljs-string\"\u003E'.js'\u003C\u002Fspan\u003E;\n  }\n\n  transformFromFilesystem(file, enc, callback) {\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create ES5 code\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { code } = transform(file.contents, {\n      \u003Cspan class=\"hljs-attr\"\u003Epresets\u003C\u002Fspan\u003E: [\u003Cspan class=\"hljs-string\"\u003E'es2015'\u003C\u002Fspan\u003E],\n    });\n\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create new file with ES5 content\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E result = file.clone();\n    result.contents = Buffer.from(code);\n\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F We're done, pass the new file to other streams\u003C\u002Fspan\u003E\n    callback(\u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E, result);\n  }\n\n  transformFromDB(file, enc, callback) {\n    callback(\u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Ignore file, remove it from the stream\u003C\u002Fspan\u003E\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"conclusion\"\u003EConclusion\u003C\u002Fh2\u003E\u003Cp\u003EWe just created a custom Transformer in no time. It transpiles ES2015 code on push and prevents overriding this code on pull.\u003C\u002Fp\u003E\n\u003Cp\u003EOf course there are many ways to improve the transformer, for example:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EHandle options to configure how babel transpiles the source code\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"further-reading\"\u003EFurther reading\u003C\u002Fh2\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Fbabeljs.io\u002Flearn-es2015\u002F\"\u003Ebabeljs.io\u003C\u002Fa\u003E provides a nice overview of ES2015 features. You can also use the \u003Ca href=\"http:\u002F\u002Fbabeljs.io\u002Frepl\u002F\"\u003EREPL\u003C\u002Fa\u003E to try out these features.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n",sections:[{title:"Overview",slug:"overview"},{title:"Step 0: Project setup",slug:"step-0-project-setup"},{title:"Step 1: Import PartialTransformer class",slug:"step-1-import-partialtransformer-class"},{title:"Step 2: Create the BabelTransformer class",slug:"step-2-create-the-babeltransformer-class"},{title:"Step 3: Use BabelTransformer",slug:"step-3-use-babeltransformer"},{title:"Step 4: Implement PartialTransformer#shouldBeTransformed",slug:"step-4-implement-partialtransformershouldbetransformed"},{title:"Step 5: Implement Transformer#transformFromFilesystem",slug:"step-5-implement-transformertransformfromfilesystem"},{title:"Step 6: Test BabelTransformer",slug:"step-6-test-babeltransformer"},{title:"Step 7: Implement Transformer#transformFromDB",slug:"step-7-implement-transformertransformfromdb"},{title:"Result",slug:"result"},{title:"Conclusion",slug:"conclusion"},{title:"Further reading",slug:"further-reading"}],title:"Tutorial: Custom Transformer"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/c.client.73866536.js"}catch(e){main="/client/legacy/c.client.426232d0.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script defer src=https://use.fontawesome.com/releases/v5.3.1/js/all.js></script> 