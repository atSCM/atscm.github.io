<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-vK3UTo/8wHbaUn+dTQD0X6dzidqc5l7gczvH+Bnowwk="> <link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-light.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-VCcaD9+X/d4QGYRX7l5aMJ8BWgwfA8d3S7i/HC9rvvw="> <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},(function(a,b,c,d,e,f){return {topics:[{title:"Updating atscm",slug:"updating-atscm",sections:[{title:"Installing new versions",slug:"installing-new-versions"},{title:"Updating your atscm project",slug:"updating-your-atscm-project"}]},{title:"Tutorial: Custom Transformer",slug:"tutorial-custom-transformer",sections:[{title:"Overview",slug:"overview"},{title:"Step 0: Project setup",slug:"step-0-project-setup"},{title:"Step 1: Import PartialTransformer class",slug:"step-1-import-partialtransformer-class"},{title:"Step 2: Create the BabelTransformer class",slug:"step-2-create-the-babeltransformer-class"},{title:"Step 3: Use BabelTransformer",slug:"step-3-use-babeltransformer"},{title:"Step 4: Implement PartialTransformer#shouldBeTransformed",slug:"step-4-implement-partialtransformershouldbetransformed"},{title:"Step 5: Implement Transformer#transformFromFilesystem",slug:"step-5-implement-transformertransformfromfilesystem"},{title:"Step 6: Test BabelTransformer",slug:"step-6-test-babeltransformer"},{title:"Step 7: Implement Transformer#transformFromDB",slug:"step-7-implement-transformertransformfromdb"},{title:"Result",slug:"result"},{title:b,slug:c},{title:d,slug:e}]},{title:"Node ID conflicts",slug:"node-id-conflicts",sections:[{title:"How atscm handles id conflicts",slug:"how-atscm-handles-id-conflicts"},{title:"How to resolve id conflicts",slug:"how-to-resolve-id-conflicts"}]},{title:"Guide: gulp.js plugins",slug:"guide-gulpjs-plugins",sections:[{title:"Using Transformer class",slug:"using-transformer-class"},{title:"Using PartialTransformer class",slug:"using-partialtransformer-class"},{title:b,slug:c},{title:d,slug:e}]},{title:"Guide: Debugging atscm",slug:"guide-debugging-atscm",sections:[]},{title:"Guide: Error handling",slug:"guide-error-handling",sections:[{title:"Adding source locations",slug:"adding-source-locations"}]},{title:"Guide: Using the API",slug:"guide-using-the-api",sections:[{title:"Installation",slug:"installation"},{title:"Configuration",slug:"configuration"},{title:"Usage",slug:"usage"},{title:"Examples",slug:"examples"}]},{title:"Contribute: Testing atscm",slug:"contribute-testing-atscm",sections:[{title:"Unit tests",slug:"unit-tests"},{title:"Integration tests",slug:"integration-tests",children:[{title:"Test setups",slug:"test-setups"}]}]},{title:"Contributing",slug:"contributing",sections:[{title:"Found a bug?",slug:"found-a-bug"},{title:"Missing a feature?",slug:"missing-a-feature"},{title:"Submission Guidelines",slug:"submission-guidelines",children:[{title:"Submitting an issue",slug:"submitting-an-issue"},{title:"Submitting a Pull Request (PR)",slug:"submitting-a-pull-request-pr"}]},{title:"Code quality control",slug:"code-quality-control"},{title:"Setting up the development environment",slug:"setting-up-the-development-environment",children:[{title:"Linting files",slug:"linting-files"},{title:"Running tests",slug:"running-tests"},{title:"Creating API documentation",slug:"creating-api-documentation"}]},{title:"Commit Message Guideline",slug:"commit-message-guideline",children:[{title:"Commit message format",slug:"commit-message-format",children:[{title:"Type",slug:"type"},{title:"Scope",slug:"scope"},{title:"Subject",slug:"subject"},{title:"Body",slug:"body"},{title:"Footer",slug:"footer"}]},{title:"Commit message linting",slug:"commit-message-linting"}]}]},{title:"Changelog",slug:"changelog",sections:[{title:"1.3.0 (2021-02-11)",slug:"130-2021-02-11",children:[{title:f,slug:"features"}]},{title:"atscm-v1.2.0 (2021-01-30)",slug:"atscm-v120-2021-01-30",children:[{title:f,slug:"features-1"}]},{title:"create-atscm-v0.1.0 (2021-01-25)",slug:"create-atscm-v010-2021-01-25"},{title:"atscm-v1.1.3 (2021-01-25)",slug:"atscm-v113-2021-01-25",children:[{title:a,slug:"bug-fixes"}]},{title:"atscm-v1.1.2 (2021-01-18)",slug:"atscm-v112-2021-01-18",children:[{title:a,slug:"bug-fixes-1"}]},{title:"atscm-v1.1.1 (2021-01-18)",slug:"atscm-v111-2021-01-18",children:[{title:a,slug:"bug-fixes-2"}]}]}]}}("Bug Fixes","Conclusion","conclusion","Further reading","further-reading","Features")),{manual:{content:"\u003Ch1 id=\"guide-using-the-api\"\u003EGuide: Using the API\u003C\u002Fh1\u003E\u003Cblockquote\u003E\n\u003Cp\u003ELearn how to use the atscm API to e.g. run server serverscripts in your node application.\n\u003Cstrong\u003EAvailable since atscm v1.0.0.\u003C\u002Fstrong\u003E Use \u003Ccode\u003Eatscm update\u003C\u002Fcode\u003E to use the latest version\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 id=\"installation\"\u003EInstallation\u003C\u002Fh2\u003E\u003Cp\u003EFirst of all, make sure your project has atscm installed: Take a look at your \u003Cem\u003Epackage.json\u003C\u002Fem\u003E file and make sure, atscm is present in the \u003Cem\u003Edependencies\u003C\u002Fem\u003E or (depending on your use case) \u003Cem\u003EdevDependencies\u003C\u002Fem\u003E section. Otherwise, \u003Cstrong\u003Einstall atscm if necessary\u003C\u002Fstrong\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E\u003Cspan class=\"hljs-comment\"\u003E# If you need atscm as a runtime-dependency\u003C\u002Fspan\u003E\nnpm install --save atscm\n\n\u003Cspan class=\"hljs-comment\"\u003E# If you need atscm as a development dependency (most likely)\u003C\u002Fspan\u003E\nnpm install --save-dev atscm\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"configuration\"\u003EConfiguration\u003C\u002Fh2\u003E\u003Cp\u003ESimilar to regular atscm projects, you need an \u003Cem\u003EAtviseproject\u003C\u002Fem\u003E file that contains atscm&#39;s configuration. A minimal example may look like this:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Atviseproject.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { Atviseproject } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-built_in\"\u003Emodule\u003C\u002Fspan\u003E.exports = \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EApiProject\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eextends\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EAtviseproject\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Add your configuration here, if needed.\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F By default, atvise server is assumed to run on opc.tcp:\u002F\u002Flocalhost:4840\u003C\u002Fspan\u003E\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EBefore you can finally require the atscm API in your project, you have to \u003Cstrong\u003Eset the \u003Ccode\u003EATSCM_CONFIG_PATH\u003C\u002Fcode\u003E environment variable\u003C\u002Fstrong\u003E, pointing to your \u003Cem\u003EAtviseproject\u003C\u002Fem\u003E file. You can do this in multiple ways:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EYou can set it in your app at runtime (\u003Cem\u003Erecommended\u003C\u002Fem\u003E)\u003C\u002Fp\u003E\n\u003Cp\u003EAdjust your app&#39;s entry file (assuming it&#39;s called \u003Cem\u003Eapp.js\u003C\u002Fem\u003E in these examples) to set the variable \u003Cstrong\u003Ebefore you import atscm\u003C\u002Fstrong\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F app.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { join } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'path'\u003C\u002Fspan\u003E);\n\nprocess.env.ATSCM_CONFIG_PATH = join(__dirname, \u003Cspan class=\"hljs-string\"\u003E'..\u002FAtviseproject.js'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Your app comes here...\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EYou can set it every time you run your application:\u003C\u002Fp\u003E\n\u003Cp\u003EE.g. instead of running your app with \u003Ccode\u003Enode .\u002Fapp.js\u003C\u002Fcode\u003E you can use \u003Ccode\u003EATSCM_CONFIG_PATH=&quot;\u002Fmy-project\u002FAtviseproject.js&quot; node .\u002Fapp.js\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EYou can also use npm scripts so you simply have to run \u003Ccode\u003Enpm run start\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-json\"\u003E\u002F\u002F package.json\n{\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;ATSCM_CONFIG_PATH=&#39;\u002Fmy-project\u002FAtviseproject.js&#39; node .\u002Fapp.js&quot;\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIf your running on windows, use \u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fcross-env\"\u003E\u003Ccode\u003Ecross-env\u003C\u002Fcode\u003E\u003C\u002Fa\u003E to set the environment variable (don&#39;t forget \u003Ccode\u003Enpm install cross-env\u003C\u002Fcode\u003E):\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-json\"\u003E\u002F\u002F package.json\n{\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;cross-env ATSCM_CONFIG_PATH=&#39;\u002Fmy-project\u002FAtviseproject.js&#39; node .\u002Fapp.js&quot;\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"usage\"\u003EUsage\u003C\u002Fh2\u003E\u003Cp\u003ERequire \u003Ccode\u003Eatscm\u002Fapi\u003C\u002Fcode\u003E and call the methods you need:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Set process.env.ATSCM_CONFIG_PATH here...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E atscm = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'atscm\u002Fapi'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F You can use atscm here...\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"examples\"\u003EExamples\u003C\u002Fh2\u003E\u003Cp\u003E\u003Cstrong\u003ECreate an export file for a node\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F app.js\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Import node core modules\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { \u003Cspan class=\"hljs-attr\"\u003Epromises\u003C\u002Fspan\u003E: fsp } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'fs'\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { join, dirname } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'path'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Set atscm config env variable\u003C\u002Fspan\u003E\nprocess.env.ATSCM_CONFIG_PATH = join(__dirname, \u003Cspan class=\"hljs-string\"\u003E'.\u002FAtviseproject.js'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Require atscm and node-opcua APIs\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { NodeId } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'atscm'\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { callMethod } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'atscm\u002Fapi'\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { Variant, DataType, VariantArrayType } = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'node-opcua'\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Configuration: You could also use process.argv here...\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E nodesToExport = [\u003Cspan class=\"hljs-string\"\u003E'AGENT.DISPLAYS.Main'\u003C\u002Fspan\u003E];\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E exportPath = \u003Cspan class=\"hljs-string\"\u003E'.\u002Fout\u002Fexport.xml'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Our main function\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EcreateExportFile\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E`Exporting nodes: \u003Cspan class=\"hljs-subst\"\u003E${nodesToExport.join(\u003Cspan class=\"hljs-string\"\u003E','\u003C\u002Fspan\u003E)}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E);\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Use the 'exportNodes' method to create an xml export on the server\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-attr\"\u003EoutputArguments\u003C\u002Fspan\u003E: [{ value }],\n  } = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E callMethod(\u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E NodeId(\u003Cspan class=\"hljs-string\"\u003E'AGENT.OPCUA.METHODS.exportNodes'\u003C\u002Fspan\u003E), [\n    \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E Variant({\n      \u003Cspan class=\"hljs-attr\"\u003EdataType\u003C\u002Fspan\u003E: DataType.NodeId,\n      \u003Cspan class=\"hljs-attr\"\u003EarrayType\u003C\u002Fspan\u003E: VariantArrayType.Array,\n      \u003Cspan class=\"hljs-attr\"\u003Evalue\u003C\u002Fspan\u003E: nodesToExport.map(\u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Eid\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E NodeId(id)),\n    }),\n  ]);\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Create the output directory if needed\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E fsp.mkdir(dirname(exportPath), { \u003Cspan class=\"hljs-attr\"\u003Erecursive\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E });\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Write the export to the file\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E fsp.writeFile(exportPath, value);\n\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E`Export written to \u003Cspan class=\"hljs-subst\"\u003E${exportPath}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E);\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Run it and catch any errors\u003C\u002Fspan\u003E\ncreateExportFile().catch(\u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Eerror\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.error(error);\n  process.exitCode = \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E;\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003ENote: The example assumes the Atviseproject file is located in the same directory as the app&#39;s entry file. Otherwise you have to adjust you code accordingly.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",sections:[{title:"Installation",slug:"installation"},{title:"Configuration",slug:"configuration"},{title:"Usage",slug:"usage"},{title:"Examples",slug:"examples"}],title:"Guide: Using the API"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e9889130.js"}catch(e){main="/client/legacy/client.eeb246ba.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.5.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-5590ed11.css rel=stylesheet> <title>Guide: Using the API – atscm</title><meta content="Guide: Using the API in the atscm manual pages" name=description data-svelte=svelte-1f9yim9> <link href=/client/client.e9889130.js rel=modulepreload crossorigin=use-credentials as=script><link href=/client/client-5590ed11.css rel=preload as=style><link href=/client/[manual].3458f912.js rel=modulepreload crossorigin=use-credentials as=script><link href=/client/inject_styles.5607aec6.js rel=modulepreload crossorigin=use-credentials as=script></head> <body> <div id=sapper> <div class="fullscreen-content svelte-30lnsi"><nav class="is-spaced navbar"><div class=container><div class=navbar-brand> <a href=. class=navbar-item><strong>atscm</strong></a> <div class="burger navbar-burger" role=button><span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span></div></div> <div class=navbar-menu><div class=navbar-start><a href=latest class=navbar-item>Readme </a> <a href=latest/docs class="navbar-item is-active">Manual </a> <a href=latest/api class="navbar-item is-active">Reference </a></div> <div class=navbar-end><div class="navbar-item has-dropdown is-hoverable"><p class=navbar-link><span>Version: <strong>latest</strong></span></p> <div class="is-right navbar-dropdown"><a href=latest class="navbar-item is-active is-flex"><span>latest (1.3.0)</span> </a><a href=beta class="navbar-item is-flex"><span>beta (1.3.0-beta.1)</span> </a></div></div> <div class="navbar-item search-item"> <div class=dropdown><div class=dropdown-trigger><div class=field><div class="control has-icons-left"><input class=input placeholder=Search... type=search> <span class="icon is-left is-small"><i class="fa-search fas"></i></span></div></div></div> </div></div> <div class=navbar-item><div class=buttons><a href=https://github.com/atscm class="button is-light"><span class=icon><i class="fa-github fab"></i></span></a></div></div></div></div></div></nav> <section class=section><div class=container><div class=columns><div class=column> <div class=content><h1 id=guide-using-the-api>Guide: Using the API</h1><blockquote> <p>Learn how to use the atscm API to e.g. run server serverscripts in your node application. <strong>Available since atscm v1.0.0.</strong> Use <code>atscm update</code> to use the latest version</p> </blockquote> <h2 id=installation>Installation</h2><p>First of all, make sure your project has atscm installed: Take a look at your <em>package.json</em> file and make sure, atscm is present in the <em>dependencies</em> or (depending on your use case) <em>devDependencies</em> section. Otherwise, <strong>install atscm if necessary</strong>:</p> <pre><code class=language-bash><span class=hljs-comment># If you need atscm as a runtime-dependency</span>
npm install --save atscm

<span class=hljs-comment># If you need atscm as a development dependency (most likely)</span>
npm install --save-dev atscm</code></pre> <h2 id=configuration>Configuration</h2><p>Similar to regular atscm projects, you need an <em>Atviseproject</em> file that contains atscm's configuration. A minimal example may look like this:</p> <pre><code class=language-js><span class=hljs-comment>// Atviseproject.js</span>
<span class=hljs-keyword>const</span> { Atviseproject } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'atscm'</span>);

<span class=hljs-built_in>module</span>.exports = <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>ApiProject</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>Atviseproject</span> </span>{
  <span class=hljs-comment>// Add your configuration here, if needed.</span>
  <span class=hljs-comment>// By default, atvise server is assumed to run on opc.tcp://localhost:4840</span>
};</code></pre> <p>Before you can finally require the atscm API in your project, you have to <strong>set the <code>ATSCM_CONFIG_PATH</code> environment variable</strong>, pointing to your <em>Atviseproject</em> file. You can do this in multiple ways:</p> <ul> <li><p>You can set it in your app at runtime (<em>recommended</em>)</p> <p>Adjust your app's entry file (assuming it's called <em>app.js</em> in these examples) to set the variable <strong>before you import atscm</strong>:</p> <pre><code class=language-js><span class=hljs-comment>// app.js</span>
<span class=hljs-keyword>const</span> { join } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'path'</span>);

process.env.ATSCM_CONFIG_PATH = join(__dirname, <span class=hljs-string>'../Atviseproject.js'</span>);

<span class=hljs-comment>// Your app comes here...</span></code></pre> </li> <li><p>You can set it every time you run your application:</p> <p>E.g. instead of running your app with <code>node ./app.js</code> you can use <code>ATSCM_CONFIG_PATH="/my-project/Atviseproject.js" node ./app.js</code>.</p> <p>You can also use npm scripts so you simply have to run <code>npm run start</code>:</p> <pre><code class=language-json>// package.json
{
  "scripts": {
    "start": "ATSCM_CONFIG_PATH='/my-project/Atviseproject.js' node ./app.js"
  }
}</code></pre> <p>If your running on windows, use <a href=https://www.npmjs.com/package/cross-env><code>cross-env</code></a> to set the environment variable (don't forget <code>npm install cross-env</code>):</p> <pre><code class=language-json>// package.json
{
  "scripts": {
    "start": "cross-env ATSCM_CONFIG_PATH='/my-project/Atviseproject.js' node ./app.js"
  }
}</code></pre> </li> </ul> <h2 id=usage>Usage</h2><p>Require <code>atscm/api</code> and call the methods you need:</p> <pre><code class=language-js><span class=hljs-comment>// Set process.env.ATSCM_CONFIG_PATH here...</span>

<span class=hljs-keyword>const</span> atscm = <span class=hljs-built_in>require</span>(<span class=hljs-string>'atscm/api'</span>);

<span class=hljs-comment>// You can use atscm here...</span></code></pre> <h2 id=examples>Examples</h2><p><strong>Create an export file for a node</strong></p> <pre><code class=language-js><span class=hljs-comment>// app.js</span>

<span class=hljs-comment>// Import node core modules</span>
<span class=hljs-keyword>const</span> { <span class=hljs-attr>promises</span>: fsp } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'fs'</span>);
<span class=hljs-keyword>const</span> { join, dirname } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'path'</span>);

<span class=hljs-comment>// Set atscm config env variable</span>
process.env.ATSCM_CONFIG_PATH = join(__dirname, <span class=hljs-string>'./Atviseproject.js'</span>);

<span class=hljs-comment>// Require atscm and node-opcua APIs</span>
<span class=hljs-keyword>const</span> { NodeId } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'atscm'</span>);
<span class=hljs-keyword>const</span> { callMethod } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'atscm/api'</span>);
<span class=hljs-keyword>const</span> { Variant, DataType, VariantArrayType } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'node-opcua'</span>);

<span class=hljs-comment>// Configuration: You could also use process.argv here...</span>
<span class=hljs-keyword>const</span> nodesToExport = [<span class=hljs-string>'AGENT.DISPLAYS.Main'</span>];
<span class=hljs-keyword>const</span> exportPath = <span class=hljs-string>'./out/export.xml'</span>;

<span class=hljs-comment>// Our main function</span>
<span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>createExportFile</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-built_in>console</span>.log(<span class=hljs-string>`Exporting nodes: <span class=hljs-subst>${nodesToExport.join(<span class=hljs-string>','</span>)}</span>`</span>);

  <span class=hljs-comment>// Use the 'exportNodes' method to create an xml export on the server</span>
  <span class=hljs-keyword>const</span> {
    <span class=hljs-attr>outputArguments</span>: [{ value }],
  } = <span class=hljs-keyword>await</span> callMethod(<span class=hljs-keyword>new</span> NodeId(<span class=hljs-string>'AGENT.OPCUA.METHODS.exportNodes'</span>), [
    <span class=hljs-keyword>new</span> Variant({
      <span class=hljs-attr>dataType</span>: DataType.NodeId,
      <span class=hljs-attr>arrayType</span>: VariantArrayType.Array,
      <span class=hljs-attr>value</span>: nodesToExport.map(<span class=hljs-function>(<span class=hljs-params>id</span>) =></span> <span class=hljs-keyword>new</span> NodeId(id)),
    }),
  ]);

  <span class=hljs-comment>// Create the output directory if needed</span>
  <span class=hljs-keyword>await</span> fsp.mkdir(dirname(exportPath), { <span class=hljs-attr>recursive</span>: <span class=hljs-literal>true</span> });

  <span class=hljs-comment>// Write the export to the file</span>
  <span class=hljs-keyword>await</span> fsp.writeFile(exportPath, value);

  <span class=hljs-built_in>console</span>.log(<span class=hljs-string>`Export written to <span class=hljs-subst>${exportPath}</span>`</span>);
}

<span class=hljs-comment>// Run it and catch any errors</span>
createExportFile().catch(<span class=hljs-function>(<span class=hljs-params>error</span>) =></span> {
  <span class=hljs-built_in>console</span>.error(error);
  process.exitCode = <span class=hljs-number>1</span>;
});</code></pre> <blockquote> <p>Note: The example assumes the Atviseproject file is located in the same directory as the app's entry file. Otherwise you have to adjust you code accordingly.</p> </blockquote> </div></div> <div class="column is-3"><aside class=menu><ul class=menu-list><li><a href=latest/docs/updating-atscm>Updating atscm</a> <li><a href=latest/docs/tutorial-custom-transformer>Tutorial: Custom Transformer</a> <li><a href=latest/docs/node-id-conflicts>Node ID conflicts</a> <li><a href=latest/docs/guide-gulpjs-plugins>Guide: gulp.js plugins</a> <li><a href=latest/docs/guide-debugging-atscm>Guide: Debugging atscm</a> <li><a href=latest/docs/guide-error-handling>Guide: Error handling</a> <li><a href=latest/docs/guide-using-the-api class=is-active>Guide: Using the API</a> <ul class=menu-list><li><a href=latest/docs/guide-using-the-api/#installation>Installation</a> <li><a href=latest/docs/guide-using-the-api/#configuration>Configuration</a> <li><a href=latest/docs/guide-using-the-api/#usage>Usage</a> <li><a href=latest/docs/guide-using-the-api/#examples>Examples</a> </li> </ul> <li><a href=latest/docs/contribute-testing-atscm>Contribute: Testing atscm</a> <li><a href=latest/docs/contributing>Contributing</a> <li><a href=latest/docs/changelog>Changelog</a> </ul></aside></div></div></div></section></div> <footer class=footer><div class="content has-text-centered"><p><strong>atscm</strong> is an open source project by <a href=https://bachmann.info>Bachmann electronics</a> · The source code is licensed <a href=http://opensource.org/licenses/mit-license.php>MIT</a></p> <p><a href=https://github.com/atSCM/atscm/blob/master/.github/CONTRIBUTING.md target=_blank>Get involved </a> · <a href=https://github.com/atSCM/docs target=_blank>Improve this page</a> · <a href=https://www.bachmann.info/en/info/imprint/ target=_blank>Imprint</a></div></footer> </div> <script defer src=https://use.fontawesome.com/releases/v5.3.1/js/all.js></script> 